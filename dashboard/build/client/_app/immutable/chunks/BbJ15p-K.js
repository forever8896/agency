import{d as n,w as S}from"./DpH9poZx.js";function g(){const{subscribe:t,set:h,update:a}=S({backlog:{columns:{}},agents:[],handoffs:[],connected:!1,lastUpdate:0,recentEvents:[]});let o=null,i=null;function d(){if(typeof window>"u")return;const c="/api/events/stream";console.log("[Store] Connecting via SSE to",c),o=new EventSource(c),o.onopen=()=>{console.log("[Store] SSE Connected"),a(s=>({...s,connected:!0}))},o.onmessage=s=>{try{const e=JSON.parse(s.data);console.log("[Store] Event:",e.type,e.agent||""),(e.type==="initial"||e.type==="file_change"||e.type==="refresh")&&e.data&&a(l=>({...l,...e.data,lastUpdate:e.serverTimestamp||Date.now()})),e.agent&&a(l=>({...l,lastUpdate:e.serverTimestamp||Date.now(),recentEvents:[e,...l.recentEvents].slice(0,20)}))}catch(e){console.error("[Store] Parse error:",e)}},o.onerror=s=>{console.error("[Store] SSE Error:",s),a(e=>({...e,connected:!1})),o==null||o.close(),o=null,i=setTimeout(d,2e3)}}function f(){i&&clearTimeout(i),o==null||o.close(),o=null}async function p(){try{await fetch("/api/refresh",{method:"POST"})}catch(c){console.error("[Store] Refresh error:",c)}}return{subscribe:t,connect:d,disconnect:f,refresh:p}}const r=g(),m=n(r,t=>t.backlog),E=n(r,t=>t.agents),b=n(r,t=>t.handoffs),v=n(r,t=>t.connected),w=n(r,t=>t.lastUpdate);n(r,t=>t.recentEvents);export{E as a,m as b,v as c,r as d,b as h,w as l};
